# YoloForge-Tagger

YoloForge-Tagger — настольное приложение на Tkinter для разметки изображений и подготовки датасетов в формате YOLO. Инструмент поддерживает ручную и автоматическую разметку, помогает вести учёт прогресса и быстро подготавливать готовые наборы изображений для обучения нейросетей.
![YoloForge-Tagger](/preview.png)

## Основные возможности
- интерактивное создание, перемещение и изменение размера ограничивающих прямоугольников;
- моментальное сохранение аннотаций при переключении изображений и закрытии программы;
- переназначение класса у готовой рамки одним кликом (выберите класс и щёлкните по рамке без перетаскивания);
- удаление рамок правой кнопкой мыши;
- поддержка нескольких задач разметки, каждая со своим набором классов и собственными моделями авторазметки;
- встроенный редактор классов (добавление и удаление записей в `classes.txt`, доступен до переноса результатов);
- статистика по текущему изображению и всему датасету с подсветкой классов;
- автоматическая разметка на основе предобученных моделей YOLO (`.pt`) с настройкой порогов, автоподбором устройства для `best.pt`, возможностью авто-запуска при прокрутке и очисткой автоматически созданных рамок;
- навигация по изображениям с помощью колёсика мыши или клавиш ←/→;
- экспорт размеченных изображений и меток в каталог `Result/<имя_задачи>` простым нажатием на колёсико мыши.

## Структура задач
Каждая задача располагается в каталоге `Tasks/<имя_задачи>` и содержит:

```
Tasks/
└── job_1/
    ├── classes.txt   # список классов, по одному на строку
    └── images/       # изображения и .txt-файлы с аннотациями
    └── *.pt          # (опционально) предобученные модели для авторазметки
```

Аннотации сохраняются в формате YOLO: `class_id x_center y_center width height` (нормированные значения). При наличии файла `best.pt` устройство выбирается автоматически: используется GPU, если доступен `torch.cuda`, иначе CPU.

## Установка
Рекомендуется использовать виртуальное окружение и Python 3.10. Пакеты следует устанавливать **строго в указанном порядке**.

### Windows

```bat
python -m venv .venv
.\.venv\Scripts\activate
:: --- установка строго в этом порядке ---
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118
pip install ultralytics
pip install numpy==1.26.4 opencv-python==4.8.0.76
```

### Linux / macOS

```bash
python3 -m venv .venv
source .venv/bin/activate
# --- установка строго в этом порядке ---
pip install torch==2.0.1 torchvision==0.15.2 --index-url https://download.pytorch.org/whl/cu118
pip install ultralytics
pip install numpy==1.26.4 opencv-python==4.8.0.76
```

## Запуск
Из корня репозитория выполните:

```bash
python bbox_master.py
```

При первом запуске выберите задачу из выпадающего списка в верхней части окна.

## Рабочий процесс
### Выбор задачи и навигация по изображениям
- Колёсико мыши — переход между изображениями (вверх — предыдущее, вниз — следующее).
- Клавиши ← и → — переключение изображений.
- Приложение автоматически сохраняет аннотации перед сменой изображения.
- Панель справа отображает текущий номер кадра, количество размеченных изображений и статистику по классам.

### Управление рамками
- ЛКМ — начало рисования новой рамки. Потяните курсор для задания размеров.
- Потяните за синюю ручку в углу рамки, чтобы растянуть или сжать её.
- Перетащите рамку за внутреннюю область, чтобы изменить позицию.
- ПКМ — удаление рамки под курсором.
- Чтобы изменить класс существующей рамки, выберите класс в списке и щёлкните по рамке без перемещения.

### Редактор классов
Нажмите «Редактировать классы», чтобы открыть отдельное окно, в котором можно добавлять и удалять записи в `classes.txt`. После сохранения цвета классов и список в главном окне обновятся. Редактирование недоступно, если в каталоге `Result` уже появились папки с названиями классов (это защищает готовые выгрузки от рассинхронизации).

### Автоматическая разметка предобученной моделью
1. Поместите файлы моделей `.pt` в каталог задачи (`Tasks/<имя_задачи>`).
2. Выберите модель в блоке «Авторазметка». Для файла `best.pt` приложение самостоятельно решит, использовать ли GPU или CPU.
3. Настройте пороги `Порог уверенности` и `IoU порог`.
4. Нажмите «Найти объекты», чтобы выполнить предсказание через `ultralytics.YOLO`.
5. Автоматически созданные рамки помечаются флагом `auto`, их можно вручную доработать или удалить кнопкой «Очистить результаты».
6. Активируйте опцию «Авто-поиск при прокрутке (если нет объектов)», чтобы модель запускалась сама при переходе к новому изображению без разметки.

### Экспорт размеченных данных
Нажмите на колёсико мыши (среднюю кнопку) или используйте подсказку в левом блоке, чтобы перенести размеченные изображения и соответствующие `.txt` из `Tasks/<имя_задачи>/images` в `Result/<имя_задачи>`. После экспорта текущая задача перезагрузится, а исходные файлы будут перемещены в раздел `Result`.

## Горячие клавиши и управление
| Действие | Управление |
| --- | --- |
| Рисование новой рамки | ЛКМ + перетаскивание |
| Перемещение рамки | ЛКМ по внутренней части + перетаскивание |
| Изменение размера | ЛКМ по синей ручке + перетаскивание |
| Удаление рамки | ПКМ |
| Смена класса рамки | Выберите класс и щёлкните ЛКМ по рамке |
| Следующее изображение | Колёсико вниз / клавиша → |
| Предыдущее изображение | Колёсико вверх / клавиша ← |
| Экспорт размеченных файлов | Нажатие колёсика мыши |

## Советы
- Приложение автоматически сохраняет аннотации в файл при каждой смене изображения и при закрытии окна, но вы всегда можете вызвать сохранение вручную через меню «Экспорт» — данные будут перенесены в `Result`.
- Если требуется повторная авторазметка, предварительно очистите автоматически созданные рамки кнопкой «Очистить результаты».
- Храните резервные копии `classes.txt`, если планируется редактирование списка классов в уже размеченном датасете.

## Лицензия
Проект распространяется на условиях лицензии MIT, см. файл [LICENSE](LICENSE).
